---
title: "Vitc"
output: html_document
date: "2022-12-02"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE)
```


```{r lib}
library(ggplot2)
library(tidyverse)
library(dplyr)
library(interactions)
library(jtools)
```

Text
```{r load_data}
jakob = "C:/Users/pertl/Desktop/Studium Mathematik/7. Barcelona/Linear and Generalized Models/Practical Exercise/VitCGroup7.csv"
ema = "C:/Users/emaca/OneDrive/Documents/INSA/4A/Linear and Generalized Linear Models/Assignment/VitCGroup7.csv"

df = read.csv2(jakob)
df$pred = log(df$VitaminaC)
rm(jakob,ema)
```

## 1)

Outcome : Concentration of vitamin C in the orange juice

Predictors : 
- Conservation method (column "Tractament" : a, b or c) which is a categorical variable
- Week of measurement (column "Setmana" from 1 to 12) 

## 2)

The data is very evenly spread out, with each week containing 6 observations and each treatment containing 24 observations. Generally we can see that Vitamin C concentration varies a lot. For example the maximum is 5 times the minimum value. Also the interquartile range is 17.22 which is quite high considering the magnitude of values involved.
```{r sum}
summary(df$VitaminaC)
```

A plot of the data shows that there seems to be a decrease VitC concentration over time. Treatment A and B appear to yield very similar results, while treatment C seems to yield higher VitC concentrations.
- The vitamin C concentration with treatment a and b decreases linearly as the weeks pass by 
- Treatment c seems to maintain a higher concentration than a and b after the 4th week 
```{r plt_data}
#simple point plot of data
ggplot(data = df) +
  aes(x = Setmana, y = VitaminaC, color = Tractament) +
    geom_point()
```

The correlation between the Vitamin C concentration and the time in weeks is a strong negative correlation at -0.86. This confirms our eyeballed observation earlier.
```{r cor}
# Correlation between Vitamin and Week
cor(x = df$VitaminaC, y = df$Setmana)
```

## 3)
Is any treatment significantly better than the others in terms of VitC concentration?
Does the Vitamin C concentration differ at packaging for different treatments?
By how much does Vitamin C concentration decrease per week?



## 4)
To answer this question, we fit a linear model to the data. As we assume the VitC concentration to be equal at the time of packaging but we are still interested in the effect of the treatment we fit the model with an interaction term but exclude the treatment itself. In mathematical terms this means that we have different $\beta$ for each treatment but our $\alpha$ is the same.
$$
VitaminC_i = \alpha e^{\beta_i .week}
$$
With $i \in \{a,b,c\}$ for each treatment.

```{r 4.1}
mod1 = lm( pred ~ Setmana * Tractament -Tractament, data = df)
summary(mod1)
```
We can see that the time and the treatment c appear to have a significant effect on the Vitamin C concentration. Let us check that our intercept is actually the same for each treatment. We do this by predicting 3 observations each with week being zero and one for each treatment.
```{r}
pr.df = data.frame(Setmana = c(0,0,0), Tractament = c("a", "b", "c"))
predict(mod1, pr.df)
```
Not let us plot our model so that we can get an understanding of what it looks like:
```{r}
interact_plot(mod1, pred = Setmana, modx = Tractament, plot.points = T)
```
In this model we find that $\alpha = 47.61488$ and $\beta[a,b,c] = [-0.1423, -0.1455, -0.0752]$. The betas are best interpreted if we take the exponential of them and we get: $e^{\beta[a,b,c]} = [0.8674, 0.8646, 0.9276]$. These are the factors we will multiply our VitC Concentration with each week. For example lets consider treatment a: each week the concentration will fall by $1-e^{\beta[a]} = 13.26\%$.

\
Finally let us check whether the betas are significantly diferent from eachother. We can do this by checking the anova table.

```{r}
anova(mod1)
```

We see that the interaction "Setmana:Tractament" is highly significant. This indicates that the betas are indeed different from eachother.

## 5)
We want to fit a model that does not assume that the treatments have the same Vitamin C concentration at the time of packaging. Thus a linear model that for each slope has a different slope and intercept.
$$
VitaminC_i = \alpha_i e^{\beta_i .week}
$$
With $i \in \{a,b,c\}$ for each treatment.
```{r}
mod2 = lm( pred ~ Setmana * Tractament, data = df)
summary(mod2)
```
We can see in the summary that most values are significant at $\alpha = 0.05$ except for the treatment C. For week zero we would predict the following levels of Vitamin C concentration for different treatments.
```{r}
A = mod2[["coefficients"]][["(Intercept)"]]
B = A + mod2[["coefficients"]][["Tractamentb"]]
C = A + mod2[["coefficients"]][["Tractamentc"]]
A = exp(A)
B = exp(B)
C = exp(C)
cbind(A,B,C)
```

Now let us have a look at a plot that shows our fitted model for each treatment

```{r}
interact_plot(mod2, pred = Setmana, modx = Tractament, plot.points = T)
```

Lastly we want to check whether there is evidence to claim that the treatments have different concentrations of Vitamin C at the time of packaging. We do this by that by assuming the anova method:
```{r}
anova(mod2)
```
We can clearly see that the variable Tractament is highly significant. This indicates that indeed that different treatments lead to a different concentration of VitC at the time of packaging.


## 6)

<!-- We can choose the best linear model by comparing the $R^2$, the mean square errors (MSE) and the Akaike Information Criterion (AIC) -->
<!-- ```{r} -->
<!-- bmod =  -->
<!-- ``` -->

<!-- ```{r} -->
<!-- #Response residual -->
<!-- df$resp_resid = residuals(bmod, type = "response") -->
<!-- ggplot(df) + -->
<!--   aes(x = resp_resid) + -->
<!--     geom_histogram() -->
<!-- ``` -->

<!-- ```{r} -->
<!-- mean(df$resp_resid > 0) -->
<!-- ``` -->

<!-- ```{r} -->
<!-- mean(df$resp_resid < 0) -->
<!-- ``` -->


<!-- ```{r} -->
<!-- #Pearson residual -->
<!-- df$resp_resid = residuals(bmod, type = "pearson") -->
<!-- ggplot(df) + -->
<!--   aes(x = resp_resid) + -->
<!--     geom_histogram() -->
<!-- ``` -->


<!-- ```{r} -->
<!-- #Deviance residual -->
<!-- df$resp_resid = residuals(bmod) -->
<!-- ggplot(df) + -->
<!--   aes(x = resp_resid) + -->
<!--     geom_histogram() -->
<!-- ``` -->

<!-- For interpretation check Lec7_sol.html -->

## 7)