---
title: "Vitc"
output: html_document
date: "2022-12-02"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE)
```


```{r lib}
library(ggplot2)
library(tidyverse)
library(dplyr)
library(interactions)
library(jtools)
```

Text
```{r load_data}
jakob = "C:/Users/pertl/Desktop/Studium Mathematik/7. Barcelona/Linear and Generalized Models/Practical Exercise/VitCGroup7.csv"
ema = "C:/Users/emaca/OneDrive/Documents/INSA/4A/Linear and Generalized Linear Models/Assignment/VitCGroup7.csv"

df = read.csv2(jakob)
rm(jakob,ema)
```

## 1)

Outcome : Concentration of vitamin C in the orange juice

Predictors : 
- Conservation method (column "Tractament" : a, b or c) which is a categorical variable
- Week of measurement (column "Setmana" from 1 to 12) 

## 2)

The data is very evenly spread out, with each week containing 6 observations and each treatment containing 24 observations. Generally we can see that Vitamin C concentration varies a lot. For example the maximum is 5 times the minimum value. Also the interquartile range is 17.22 which is quite high considering the magnitude of values involved.
```{r sum}
summary(df$VitaminaC)
```

A plot of the data shows that there seems to be a decrease VitC concentration over time. Treatment A and B appear to yield very similar results, while treatment C seems to yield higher VitC concentrations.
- The vitamin C concentration with treatment a and b decreases linearly as the weeks pass by 
- Treatment c seems to maintain a higher concentration than a and b after the 4th week 
```{r plt_data}
#simple point plot of data
ggplot(data = df) +
  aes(x = Setmana, y = VitaminaC, color = Tractament) +
    geom_point()
```

The correlation between the Vitamin C concentration and the time in weeks is a strong negative correlation at -0.86. This confirms our eyeballed observation earlier.
```{r cor}
# Correlation between Vitamin and Week
cor(x = df$VitaminaC, y = df$Setmana)
```

## 3)
Is any treatment significantly better than the others in terms of VitC concentration?
Does the Vitamin C concentration differ at packaging for different treatments?
By how much does Vitamin C concentration decrease per week?



## 4.1)
To answer this question, we fit a generalized linear model to the data taking only the week of measurement as parameter. We use Poisson's family to fit the data and we consider $\beta_0$ as the intercept.

$$
VitaminC_i = e^{\beta_0 + \beta .week} = \alpha e^{\beta .week}
$$
With : $\alpha = e^{\beta_0}$ and $\beta_0$ the intercept.


```{r 4.1}
mod1 = glm( VitaminaC ~ Setmana, data = df, family = "poisson" )
alpha = exp(mod1[["coefficients"]][["(Intercept)"]])
beta = mod1[["coefficients"]][["Setmana"]]
exp.beta = exp(beta)
summary(mod1)
cbind(alpha, beta, exp.beta)
```
Here we only have one value each for alpha and beta as we do not consider different treatments. Alpha is interpreted as the predicted VitC concentration at week 0. Beta is best interpreted as follows: For each additional week the VitC concentration decreases by 1-exp.beta percent. In our case this means each week VitC concentration falls by 10.4 percent. Both alpha and beta are highly significant. Here we plotted the model:
```{r}
effect_plot(mod1, pred = Setmana, plot.points = T)
```



## 4.2)
We fit a multiplicative generalized linear model to the data taking the week of measurement and the conservation method as parameters. This model will also consider the interactions between our predictors.

$$
VitaminC_i = e^{\gamma_i + \beta_i .week} = \alpha_i e^{\beta_i .week}
$$
With $i \in \{1,2,3\}$ for each treatment.

```{r 4.2}
mod2 = glm( VitaminaC ~ Setmana*Tractament, data = df, family = "poisson" )
summary(mod2)

#creating array of different alpha values
int = mod2[["coefficients"]][["(Intercept)"]]
alpha = exp(c(int, int+mod2[["coefficients"]][["Tractamentb"]], int+mod2[["coefficients"]][["Tractamentc"]]))

#creating array of different beta values
set = mod2[["coefficients"]][["Setmana"]]
beta = c(set, set+mod2[["coefficients"]][["Setmana:Tractamentb"]], set+mod2[["coefficients"]][["Setmana:Tractamentc"]])

exp.beta = exp(beta)

rbind(alpha,beta, exp.beta)

```
Now we have different alpha and beta values for each treatment. The interpretation is similar to above. The alpha values tell us the predicted VitC concentration at week 0 for each treatment. So alpha[1]=43.73 is the predicted VitC concentration at time 0 for treatment A. The Betas are best interpreted as follows: For each additional week the VitC concentration decreases by 1-exp.beta percent. So we predict that each week the Vit C concentration falls by 1-exp.beta[1] = 12.17 percent for treatment A. Note that most of the interactions are not statistically significant. Only the influence of treatment C on the beta is significant. By statistically significant we mean that assuming the influence to be nothing it is very unlikely that we would observe the data the way it is. As we actually did observe the result we should reject the premise that the influence was zero. Below we plotted the model:

```{r}
interact_plot(mod2, pred = Setmana, modx = Tractament, plot.points = T,
              point.size = 3)
```

INTERPRETATION OF THE $\beta_i$

## 5)

```{r}

```

## 6)

<!-- We can choose the best linear model by comparing the $R^2$, the mean square errors (MSE) and the Akaike Information Criterion (AIC) -->
<!-- ```{r} -->
<!-- bmod =  -->
<!-- ``` -->

<!-- ```{r} -->
<!-- #Response residual -->
<!-- df$resp_resid = residuals(bmod, type = "response") -->
<!-- ggplot(df) + -->
<!--   aes(x = resp_resid) + -->
<!--     geom_histogram() -->
<!-- ``` -->

<!-- ```{r} -->
<!-- mean(df$resp_resid > 0) -->
<!-- ``` -->

<!-- ```{r} -->
<!-- mean(df$resp_resid < 0) -->
<!-- ``` -->


<!-- ```{r} -->
<!-- #Pearson residual -->
<!-- df$resp_resid = residuals(bmod, type = "pearson") -->
<!-- ggplot(df) + -->
<!--   aes(x = resp_resid) + -->
<!--     geom_histogram() -->
<!-- ``` -->


<!-- ```{r} -->
<!-- #Deviance residual -->
<!-- df$resp_resid = residuals(bmod) -->
<!-- ggplot(df) + -->
<!--   aes(x = resp_resid) + -->
<!--     geom_histogram() -->
<!-- ``` -->

<!-- For interpretation check Lec7_sol.html -->

## 7)